<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/v-tooltip"></script>
    <script src="https://cdn.jsdelivr.net/npm/v-copy@0.1.0/dist/v-copy.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style type="text/css">
      div#grid {
        margin-top: 1vw;
        width: 60%;
        display: grid;
        grid-template-columns: 30px 1fr 1fr 1fr 20px;
        grid-auto-rows: 50px;
      }
      div.gridcell { font-size: 12pt;}
      div.gridheader {font-weight: bold;}
    </style>
  </head>
  <body>
    <div id="app" v-bind:class="title">
      <h1>{{ title }}</h1>
      <users-list v-bind:users="gridData" v-bind:show="showGrid">
      </users-list>

      <div></div>
      <button id="toggleGrid" v-on:click="showGrid = !showGrid" v-tooltip="help" v-copy="`some text`" v-copy:callback="handleCopied">
        Click me
        {{ showGrid ? ' to hide grid!' : 'to show grid!' }}
      </button>
    </div>

    <template id="user-list">
      <div>
        <span v-show="show">Number of users: {{ userCount }}</span>
        <div id="grid" v-show="show">
          <div class="gridheader">ID</div>
          <div class="gridheader">NAME</div>
          <div class="gridheader">SURNAME</div>
          <div class="gridheader">PATRONYMIC</div>
          <div class="gridheader">AVATAR</div>
          <template v-for="(item,index) in users">
            <div class="gridcell" v-bind:id="'uid'+item.id + '_id'">
              {{item.id}}
            </div>
            <div class="gridcell" v-bind:id="'uid'+item.id + 'firstname'">
              {{item.firstName}}
            </div>
            <div class="gridcell" v-bind:id="'uid'+item.id + '_secondname'">
              {{ item.secondName | capitalize }}
            </div>
            <div class="gridcell" v-bind:id="'uid'+item.id + '_patronymic'">
              {{item.patronymic}}
            </div>
            <div class="gridcell" v-bind:id="'uid'+item.id + '_avatar'">
              <img source v-bind:src="getAvatarLink(item)" height="30px" type="img"/>
            </div>
          </template>
        </div>
      </div>
    </template>

    <script>

      var usersList = {
        data: function () {
          return {}
        },
        props: {
          users: {
            type: Array,
            default: []
          },
          show: {
            type: Boolean,
            default: true
          }
        },
        template: '#user-list',
        methods: {
          getAvatarLink: function(item) {
            return item.avatarLink == null ? 'http://s3.amazonaws.com/37assets/svn/765-default-avatar.png' : item.avatarLink;
          }
        },
        filters: {
          capitalize: function (value) {
            value = value.toString();
            if (!value) return '';
            return value.toUpperCase();
          }
        },
        computed: {
          userCount: function() {
            return this.users.length;
          }
        }
      };

      // Vue instance
      new Vue({
        el: '#app',
        components: {
          'users-list': usersList
        },
        data: function() {
          return {
            help: 'Just click me to toggle grid visibility',
            title: 'Hi! Welcome to my simple userlist App!',
            gridData: [],
            showGrid: true
          }
        },
        mounted: function () {
          console.log('App has been mounted!');
          var self = this;
          axios
          .get('http://localhost:5000/users/')
          .then(response => (this.gridData = response.data))
          .catch(function (error) {
            self.gridData = [];
            console.error('cannot read user list from API');
          });
        },
        methods: {
          titleSize: function() {
            return this.gridData.length;
          },
          handleCopied: function(text) {
            console.log(`Copied: ${text}`);
          }
        }
      });
    </script>
  </body>
</html>
